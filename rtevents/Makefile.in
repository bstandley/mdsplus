include @top_srcdir@/Makefile.inc

LD=@CXX@
CFLAGS=@CFLAGS@ @SRBINCLUDE@ -fPIC 
CXXFLAGS=-g -O2 -Wno-deprecated -fPIC @CFLAGS@
LIBS=-L@MAKESHLIBDIR@ @LIBS@ @SRBLIB@ -lMdsIpShr -lMdsShr @SOCKETLIB@

ifeq "@MINGW@" "yes"
  WIN_CXXSOURCES = WindowsSharedMemory.cpp
else
  WIN_CXXSOURCES =
endif
CXXSOURCES = \
	AllocationManager.cpp EventManager.cpp RelativePointer.cpp Event.cpp\
	ExitHandler.cpp TCPNetworkManager.cpp UDPNetworkManager.cpp EventHandler.cpp Notifier.cpp Thread.cpp $(WIN_CXXSOURCES)

SOURCES = MdsEvents.c
OBJECTS = $(CXXSOURCES:.cpp=.o)  $(SOURCES:.c=.o)
EXPORTS = RtEventsShr.exports

EventConnector = @MAKEBINDIR@EventConnector
RtEventsShr_shared = @MAKESHLIBDIR@libRtEventsShr@SHARETYPE@
RtEventsShr_static = @MAKELIBDIR@libRtEventsShr.a

all : @MAKELIBDIR@ @MAKESHLIBDIR@ $(EventConnector) $(RtEventsShr_shared) $(RtEventsShr_static)

clean:
	@ $(RM) $(OBJECTS)
	@ $(RM) so_locations
	@ $(RM) $(EventConnector)
	@ $(RM) $(RtEventsShr_shared)
	@ $(RM) $(RtEventsShr_static)

depend:
	 @makedepend -- $(CFLAGS) -- $(SOURCES)

install:
	if [ ! -d @libdir@ ] ; then \
                mkdir @libdir@; \
                chmod 755 @libdir@; \
        fi;
	$(INSTALL) -m 755 $(RtEventsShr_shared) @libdir@
	if test @SHARETYPE@ != .a ; then \
		$(INSTALL) -m 644 $(RtEventsShr_static) @libdir@; \
	fi;

$(RtEventsShr_shared): $(OBJECTS) @EXPORTS_FILE@ 
	$(LD) -o $@ $(CXXFLAGS) @LINKSHARED@ $^ $(LIBS)

$(RtEventsShr_static): $(OBJECTS)
	$(AR) -cr $@ $^
	$(RANLIB) $@

@MAKELIBDIR@ :
	mkdir -p $@

$(EventConnector): $(RtEventsShr_shared)
	$(CXX) -o $@ $(CXXFLAGS) EventConnector.cpp -L@MAKESHLIBDIR@ -lRtEventsShr $(LIBS) @NSLLIB@


RtEventsShr.exports: RtEventsShr.def
	sed -e /LIBRARY/\;/\;/d RtEventsShr.def > $@

