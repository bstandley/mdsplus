include @top_srcdir@/Makefile.inc

ifeq "@MINGW@" "yes"
	IMPLIB=@MAKELIBDIR@Mdsdcl.dll.a
	MAKE_IMPLIB=-Wl,--out-implib,$(IMPLIB)
endif

INSTALL=@top_srcdir@/conf/install-sh -c

SOURCES = 		\
mdsdcl_dcl_parse.c		\
mdsdcl_do_command.c	\
mdsdcl_dummy.c		\
mdsdcl_general.c		\
mdsdcl_get_input.c		\
mdsdcl_initialize.c	\
mdsdcl_insert_symbols.c	\
mdsdcl_tables.c		\
MdsdclThreadSafe.c	\
mdsdcl_macros.c		\
mdsdcl_set_command.c	\
mdsdcl_show_vm.c        \
mdsdcl_spawn.c		\
mdsdcl_wait.c

OBJECTS = $(SOURCES:.c=.o)
EXPORTS = mdsdclshr.export

all:	@MAKELIBDIR@ @MAKEBINDIR@ @MAKELIBDIR@libMdsdcl.a  @MAKESHLIBDIR@libMdsdcl@SHARETYPE@ @MAKEBINDIR@mdsdcl

clean:
	@ $(RM) $(OBJECTS) mdsdcl.o
	@ $(RM) so_locations
	@ $(RM) mdsdcl_tables.c
	@ $(RM) @MAKELIBDIR@libMdsdcl.a
	@ $(RM) @MAKESHLIBDIR@libMdsdcl@SHARETYPE@
	@ $(RM) @MAKEBINDIR@mdsdcl
	ifdef IMPLIB
	@ $(RM) $(IMPLIB)
	endif

depend: 
	 @makedepend -- $(CFLAGS) -- $(SOURCES) mdsdcl.c

install:
	if [ ! -d @libdir@ ] ; then \
                mkdir @libdir@; \
                chmod 755 @libdir@; \
        fi;
	$(INSTALL) -m 755  @MAKESHLIBDIR@libMdsdcl@SHARETYPE@ @libdir@
	ifdef IMPLIB
	$(INSTALL) -m 755  $(IMPLIB) @libdir@
	$(INSTALL) -m 755  @MAKEBINDIR@mdsdcl	@bindir@

cdudir = $(top_builddir)/cdu
LINK_CDU = $(cdudir)/libCdu.a
CDU = $(cdudir)/cdu

mdsdcl_tables.c:	mdsdcl_tables.ocld
	if [ "@LIBPATH@" == "PATH" ]; then env PATH="@MAKESHLIBDIR@:$$(dirname $$(which gcc))" $(CDU) < mdsdcl_tables.ocld;\
              else env @LIBPATH@=@MAKESHLIBDIR@ $(CDU) < mdsdcl_tables.ocld; fi

@MAKELIBDIR@libMdsdcl.a:	$(OBJECTS)
		$(AR) -cr $@ $(OBJECTS)
		@RANLIB@ $@

@MAKESHLIBDIR@libMdsdcl@SHARETYPE@:	$(OBJECTS)
	$(LD)  -o $@ @LINKSHARED@ $(OBJECTS) $(LINK_CDU) -L@MAKESHLIBDIR@ -lMdsShr  $(LIBS) $(LDFLAGS) $(MAKE_IMPLIB)

@MAKEBINDIR@mdsdcl:	mdsdcl.o
	$(CC) $(CFLAGS) @CC_LDFLAGS@ -o $@ mdsdcl.o -L@MAKESHLIBDIR@ -lMdsdcl -lMdsShr -L@MAKELIBDIR@ $(LINK_CDU)
